# Тести HealthRisk.AI

Цей каталог містить комплексну систему тестів для проєкту HealthRisk.AI.

## Структура

```
tests/
├── backend/          # Тести бекенду
│   ├── unit/         # Unit-тести (окремі функції, утиліти)
│   ├── integration/  # Інтеграційні тести (API endpoints)
│   ├── e2e/          # End-to-end тести (повні сценарії)
│   └── experimental/ # Експериментальні тести (граничні випадки)
├── ml/               # Тести ML моделей
│   ├── unit/         # Unit-тести (завантаження, логіка)
│   ├── metrics/      # Тести метрик (accuracy, ROC-AUC, F1)
│   └── experimental/ # Експериментальні тести (чутливість, робастність)
├── frontend/         # Тести фронтенду (поки що порожньо)
└── utils/            # Утиліти та фікстури для тестів
```

## Запуск тестів

### Всі тести
```bash
make test
# або
pytest tests/
```

### Тільки бекенд
```bash
make test-backend
# або
pytest tests/backend/
```

### Тільки ML
```bash
make test-ml
# або
pytest tests/ml/
```

### Тільки експериментальні
```bash
make test-experimental
# або
pytest tests/backend/experimental/ tests/ml/experimental/
```

### З покриттям коду
```bash
make test-coverage
# або
pytest --cov=src --cov-report=html --cov-report=term tests/
```

## Типи тестів

### Unit-тести
Тестують окремі функції та методи:
- Хешування паролів
- JWT токени
- Валідація Pydantic схем
- Завантаження моделей
- Логіка прогнозування

### Integration-тести
Тестують API endpoints з реальною БД:
- Реєстрація та логін
- Прогнозування
- Історія прогнозів
- Профіль користувача

### E2E тести
Тестують повні сценарії користувача:
- Реєстрація → логін → прогноз → історія
- Прогноз → збереження → отримання історії

### ML тести
Тестують ML моделі:
- Валідність вихідних значень (0-1)
- Детермінізм (однаковий вхід → однаковий вихід)
- Коректність на реалістичних даних

### Експериментальні тести
Тести для дипломної роботи:
- Екстремальні значення (вік 120, ІМТ 60, тиск 250/150)
- Мінімальні значення (вік 1, ІМТ 10)
- Пропущені дані (NaN, None)
- Чутливість до змін факторів
- Робастність до зашумлених даних

## Фікстури

Загальні фікстури знаходяться в `conftest.py`:
- `test_db` - тимчасова тестова БД
- `client` - FastAPI тестовий клієнт
- `sample_user_data` - тестові дані користувача
- `sample_prediction_data` - тестові дані для прогнозування

Додаткові фікстури в `utils/fixtures.py`:
- `auth_headers` - заголовки з токеном авторизації
- `extreme_prediction_data` - екстремальні дані
- `missing_data_prediction` - дані з пропущеними значеннями

## Генератори тестових даних

Утиліти для генерації тестових даних в `utils/test_data_generators.py`:
- `generate_realistic_prediction_data()` - реалістичні дані
- `generate_extreme_cases()` - екстремальні випадки
- `generate_missing_data_cases()` - випадки з пропущеними даними
- `generate_sensitivity_test_cases()` - варіації для тестування чутливості

## Примітки

- ML тести вимагають навчених моделей в `artifacts/models/`
- Деякі тести можуть бути пропущені, якщо моделі не знайдено (використовується `@pytest.mark.skipif`)
- Тести використовують тимчасову БД, яка створюється для кожного тесту
- Для запуску тестів потрібно встановити залежності: `pip install -r requirements.txt`

## Додавання нових тестів

1. Створіть файл `test_*.py` у відповідній папці
2. Імпортуйте необхідні фікстури з `conftest.py`
3. Використовуйте маркери pytest для категорізації:
   - `@pytest.mark.unit`
   - `@pytest.mark.integration`
   - `@pytest.mark.e2e`
   - `@pytest.mark.experimental`

## Документація

Детальніше про структуру та підхід до тестування див. `TESTING_STRUCTURE.md` в корені проєкту.

