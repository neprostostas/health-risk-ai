# EDA: дослідницький аналіз даних (Exploratory Data Analysis)

EDA був другим етапом магістерської роботи після ETL, на якому перевірялась якість даних, аналізувались розподіли змінних та зв'язки між ознаками. Результати EDA дозволили сформувати гіпотези про фактори ризику, обґрунтувати вибір ключових ознак для моделювання та визначити підходи до обробки пропущених значень. Ці висновки безпосередньо вплинули на архітектуру моделей машинного навчання та їх продуктивність.

## Вихідні дані для аналізу

Для EDA використовується готовий оброблений датасет `datasets/processed/health_dataset.csv`, який був створений на етапі ETL. Детальний опис цього датасету наведено у документації `docs/DATA/DATA.md`.

Датасет містить 9770 рядків та 10 колонок, включаючи:

- **Демографічні змінні:** вік (`RIDAGEYR`), стать (`RIAGENDR`)
- **Антропометрія:** індекс маси тіла (`BMXBMI`)
- **Артеріальний тиск:** систолічний (`BPXSY1`) та діастолічний (`BPXDI1`)
- **Лабораторні показники:** глюкоза (`LBXGLU`), холестерин (`LBXTC`)
- **Статус захворювань:** діагностований діабет (`DIQ010`)
- **Цільові змінні:** наявність ожиріння (`obesity_present`), наявність діабету (`diabetes_present`)

## Скрипти та інструменти EDA

Основна логіка EDA реалізована у модулі `src/analysis/explore_data.py` (приблизно 360 рядків коду). Скрипт використовує стандартні бібліотеки Python для аналізу даних та візуалізації:

- **pandas** — для роботи з датафреймами та обчислення статистики
- **matplotlib** — для створення базових графіків
- **seaborn** — для побудови складніших візуалізацій (боксплоти, теплокарти)
- **numpy** — для математичних обчислень та регресійних ліній

EDA запускається через виконання модуля напряму:

```bash
python -m src.analysis.explore_data
```

Скрипт `explore_data.py` виконує наступні основні кроки:

1. **Завантаження даних** — зчитування `health_dataset.csv` з директорії `datasets/processed/`
2. **Базові описові статистики** — розмір датасету, назви колонок, основні метрики (середнє, медіана, стандартне відхилення)
3. **Аналіз пропущених значень** — підрахунок та відсоток пропусків для кожної колонки
4. **Розрахунок метрик здоров'я** — відсоток людей з ожирінням та діабетом, середні значення показників для різних груп
5. **Побудова розподілів** — гістограми, боксплоти, діаграми розсіювання для ключових змінних
6. **Кореляційний аналіз** — обчислення кореляційної матриці та побудова теплокарти
7. **Збереження артефактів** — всі графіки зберігаються у `artifacts/eda/` у форматі PNG, текстовий звіт записується у `artifacts/eda/summary.txt`

## Основні візуалізації та висновки

У директорії `artifacts/eda/` зберігаються наступні візуалізації та результати аналізу:

### Розподіли та описові статистики

**`bmi_hist.png`** — гістограма розподілу індексу маси тіла (ІМТ). Графік показує, що розподіл ІМТ має правостороннє спотворення, що вказує на наявність значної кількості людей з підвищеною масою тіла. Більшість значень зосереджені в діапазоні 20–30, що відповідає нормальній та надмірній вазі.

**`bmi_box_gender.png`** — боксплот розподілу ІМТ за статтю. Візуалізація дозволяє порівняти розподіли ІМТ між чоловіками та жінками, виявити різниці в медіанних значеннях та наявність викидів у кожній групі.

**`bp_dist.png`** — розподіли систолічного та діастолічного артеріального тиску. Графік показує два гістограми поруч, що дозволяє оцінити нормальність розподілів та виявити потенційні аномалії в даних про тиск.

### Зв'язки між змінними

**`age_bmi_scatter.png`** — діаграма розсіювання залежності між віком та ІМТ. Візуалізація демонструє, чи існує кореляція між цими змінними та як змінюється ІМТ з віком. Зазвичай спостерігається тенденція до збільшення ІМТ з віком у дорослих.

**`chol_bmi_scatter.png`** — діаграма розсіювання залежності між холестерином та ІМТ з лінією регресії. Графік показує позитивну кореляцію між цими показниками: вищий ІМТ асоціюється з вищими рівнями холестерину. Лінія регресії допомагає візуалізувати загальний тренд.

**`correlations_heatmap.png`** — теплокарта кореляційної матриці між усіма числовими ознаками. Ця візуалізація є ключовою для розуміння взаємозв'язків між змінними. Вона показує, що:
- Існують помірні кореляції між артеріальним тиском, ІМТ та холестерином
- Вік корелює з багатьма показниками здоров'я
- Деякі змінні мають слабкий зв'язок, що підтверджує їх незалежність

### Аналіз цільових змінних

**`obesity_gender.png`** — розподіл наявності ожиріння за статтю (countplot). Графік показує абсолютну кількість людей з ожирінням та без нього в кожній статевій групі. Це дозволяє оцінити, чи є різниця в поширеності ожиріння між чоловіками та жінками.

**`diabetes_age.png`** — розподіл діабету за віковими групами (barplot). Візуалізація демонструє відсоток людей з діабетом у різних вікових категоріях (<30, 30–50, >50 років). Графік чітко показує, що старший вік пов'язаний із значно вищим ризиком діабету, що є очікуваним результатом з медичної точки зору.

### Текстовий підсумок (summary.txt)

Файл `artifacts/eda/summary.txt` містить структурований текстовий звіт про результати EDA. Він включає:

- **Базову інформацію про датасет:** розмір (9770 рядків, 10 колонок), список усіх змінних
- **Аналіз пропущених значень:** для кожної колонки вказано кількість та відсоток пропусків. Найбільше пропусків спостерігається в артеріальному тиску (близько 26.6%) та холестерині (близько 22%), що впливає на подальшу обробку даних
- **Базову статистику:** описові метрики (середнє, медіана, стандартне відхилення, мінімум, максимум, квартилі) для всіх числових змінних
- **Метрики здоров'я:** 
  - Відсоток людей з ожирінням: 24.02% (2347 осіб)
  - Відсоток людей з діабетом: 7.54% (737 осіб)
  - Середні значення ключових показників для груп з ожирінням та без нього, що показує, що люди з ожирінням мають вищий середній вік (45.67 vs 28.72), вищий ІМТ (36.13 vs 22.02) та вищий холестерин (188.34 vs 175.89)

Цей текстовий звіт слугує основою для подальшого аналізу та прийняття рішень щодо обробки даних та вибору моделей.

## Як результати EDA вплинули на вибір ознак і моделей

Результати EDA безпосередньо вплинули на вибір ключових ознак для моделювання. На основі аналізу кореляцій, розподілів та зв'язків між змінними були відібрані наступні ознаки, які використовуються в моделях для прогнозування ожиріння та діабету:

- **Вік (`RIDAGEYR`)** — важлива ознака, оскільки старший вік асоціюється з вищими ризиками обох захворювань
- **Стать (`RIAGENDR`)** — використовується для врахування статевих відмінностей у розподілі ризиків
- **Індекс маси тіла (`BMXBMI`)** — ключова ознака для прогнозування ожиріння та пов'язаних з ним ризиків
- **Артеріальний тиск (`BPXSY1`, `BPXDI1`)** — важливі показники, які корелюють з обома цільовими змінними
- **Холестерин (`LBXTC`)** — показник, який демонструє кореляцію з ІМТ та загальним станом здоров'я
- **Глюкоза (`LBXGLU`)** — критична ознака для прогнозування діабету, додається до моделей, якщо доступна в датасеті

Деякі ознаки були відкинуті або обмежені через:

- **Надто багато пропусків** — наприклад, артеріальний тиск має 26.6% пропусків, що потребує спеціальної обробки під час навчання моделей
- **Дублювання інформації** — деякі змінні можуть бути високо корельовані між собою, тому для уникнення мультиколінеарності обираються найбільш інформативні
- **Слабкий зв'язок із цільовими змінними** — змінні, які не демонструють значущого зв'язку з ожирінням або діабетом, виключаються з моделей

Кореляційна матриця з EDA допомогла виявити взаємозв'язки між ознаками та уникнути проблеми мультиколінеарності. Розподіли та візуалізації дозволили зрозуміти природу даних та обґрунтувати вибір методів обробки пропущених значень (наприклад, видалення рядків з пропусками в ключових ознаках під час навчання моделей).

## Роль EDA в магістерському проєкті

EDA був другим етапом після ETL (об'єднання та очищення NHANES-даних) і передував етапу тренування моделей машинного навчання. Він дозволив сформувати гіпотези про фактори ризику здоров'я, вибрати основні показники для моделювання та обґрунтувати вибір архітектури моделей.

Результати EDA (графіки та текстовий звіт) використовуються у пояснювальній записці магістерської роботи, частково в PDF-звітах, а також інтегровані у веб-інтерфейс проєкту. На сторінці діаграм веб-застосунку відображаються ключові візуалізації з EDA, що дозволяє користувачам краще розуміти розподіли показників здоров'я та їх взаємозв'язки. Це робить систему більш прозорою та зрозумілою для кінцевих користувачів, які можуть бачити, на основі яких даних та аналізів формуються прогнози ризиків.

